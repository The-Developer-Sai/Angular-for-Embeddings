<div class="container">
  <!-- Navigation Bar -->
  <nav class="navbar">
    <button class="nav-button" (click)="preProcess()">Pre Process</button>
    <button class="nav-button" (click)="showSavedResults()">Saved</button>
    <button class="nav-button" (click)="showChat()">Chat</button>
    <button class="nav-button" (click)="showRagValidation()">RAG Validation</button>
  </nav>

  <!-- Main Screen powered by Vector Guardians -->
  <div *ngIf="!showForm && !showSaved && !showChatPage && !showRagPage" class="welcome-section">
    <h1>Powered by Vector Guardians</h1>
  </div>

  <!-- File upload form -->
  <div *ngIf="showForm">
    <form (ngSubmit)="onSubmit($event, fileInput)" enctype="multipart/form-data">
      <!-- Step 1: File Upload -->
      <div class="form-group">
        <label for="file-upload">Upload a File</label>
        <input type="file" #fileInput (change)="onFileSelected($event)" required />
      </div>

      <!-- Step 2: Model Selection -->
      <div class="form-group">
        <label for="model_choice">Choose a Model</label>
        <select [(ngModel)]="selectedModel" name="model_choice" required>
          <option value="" disabled>Select Model</option>
          <option value="BERT Base Uncased">BERT Base Uncased</option>
          <option value="BERT Large Uncased">BERT Large Uncased</option>
          <option value="BERT Multilingual">BERT Multilingual</option>
        </select>
      </div>

      <!-- Submit Button -->
      <div class="form-group">
        <button type="submit" [disabled]="loading">Upload and Process</button>
      </div>
    </form>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="loading-spinner">
      <p>Loading, please wait...</p>
    </div>

    <!-- Display Results -->
    <div *ngIf="!loading && results.length > 0" class="results-container">
      <h3>Results</h3>
      <!-- Loop through results and display each result -->
      <div *ngFor="let result of results">
        <p><strong>File Name:</strong> {{ result.file_name }}</p>
        <p><strong>File Size:</strong> {{ result.file_size | number }} bytes</p>
        <p><strong>Selected Model:</strong> {{ result.selected_model_name }}</p>
        <p><strong>Time Taken:</strong> {{ result.time }} seconds</p>
        <p><strong>Vector Quality:</strong> {{ result.vector_quality }}</p>
        <p><strong>Retrieval Accuracy:</strong> {{ result.retrieval_accuracy }}</p>

        <!-- Embeddings in Table Format -->
        <h4>Embeddings</h4>
        <div class="embeddings-table-container">
          <table>
            <thead>
              <tr>
                <th>Index</th>
                <th *ngFor="let column of result.column_names">{{ column }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let embedding of result.embeddings; let i = index">
                <td>{{ i + 1 }}</td>
                <td *ngFor="let value of embedding">{{ value }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Save and Leave buttons -->
        <button (click)="saveResult(result)">Save Result</button>
        <button (click)="leaveResult(result)">Leave</button>
      </div>
    </div>
  </div>

  <!-- Saved Results -->
  <div *ngIf="showSaved">
    <h3>Saved Results</h3>
    <div *ngFor="let savedResult of savedResults">
      <p><strong>File Name:</strong> {{ savedResult.file_name }}</p>
      <p><strong>File Size:</strong> {{ savedResult.file_size | number }} bytes</p>
      <p><strong>Selected Model:</strong> {{ savedResult.selected_model_name }}</p>
      <p><strong>Vector Quality:</strong> {{ savedResult.vector_quality }}</p>
      <p><strong>Retrieval Accuracy:</strong> {{ savedResult.retrieval_accuracy }}</p>

      <!-- Embeddings in Saved Results (Table Format) -->
      <h4>Embeddings</h4>
      <div class="embeddings-table-container">
        <table>
          <thead>
            <tr>
              <th>Index</th>
              <th *ngFor="let column of savedResult.column_names">{{ column }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let embedding of savedResult.embeddings; let i = index">
              <td>{{ i + 1 }}</td>
              <td *ngFor="let value of embedding">{{ value }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Chat Page -->
  <div *ngIf="showChatPage" class="chat-section">
    <h1>Under Deployment</h1>
  </div>

  <!-- RAG Validation Page -->
  <div *ngIf="showRagPage" class="rag-section">
    <h1>Under Deployment</h1>
  </div>
</div>
